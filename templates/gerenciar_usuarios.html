{% extends "base.html" %}

{% block title %}Gerenciar Usuários - Sistema Academia{% endblock %}

{% block content %}
<div class="card">
    <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px;">
        <h2 style="color: #6a1b9a; margin: 0;"><i class="fas fa-users-cog"></i> Gerenciar Usuários</h2>
        <a href="{{ url_for('criar_usuario') }}" class="btn"><i class="fas fa-plus"></i> Novo Usuário</a>
    </div>

    {% with messages = get_flashed_messages(with_categories=true) %}
    {% if messages %}
        {% for category, message in messages %}
        <div class="alert alert-{{ 'success' if category == 'success' else 'danger' if category == 'error' else 'warning' }}">
            {{ message }}
        </div>
        {% endfor %}
    {% endif %}
    {% endwith %}

    <div style="background: #f0f0f0; padding: 15px; border-radius: 8px; margin-bottom: 20px; border: 1px solid #ddd;">
        <strong><i class="fas fa-info-circle"></i> Informações:</strong> 
        Total de usuários cadastrados: <strong>{{ usuarios|length }}</strong>
    </div>

    <table class="table">
        <thead>
            <tr>
                <th>Nome Completo</th>
                <th>Usuário</th>
                <th>E-mail</th>
                <th>Tipo</th>
                <th>Status</th>
                <th>Último Login</th>
                <th>Ações</th>
            </tr>
        </thead>
        <tbody>
            {% for usuario in usuarios %}
            <tr {% if not usuario.ativo %}style="opacity: 0.6; background-color: #f8f9fa;"{% endif %}>
                <td><strong>{{ usuario.nome_completo }}</strong></td>
                <td>{{ usuario.username }}</td>
                <td>{{ usuario.email }}</td>
                <td>
                    {% if usuario.is_admin() %}
                        <span class="badge admin"><i class="fas fa-crown"></i> Administrador</span>
                    {% else %}
                        <span class="badge colaborador"><i class="fas fa-user"></i> Colaborador</span>
                    {% endif %}
                </td>
                <td>
                    {% if usuario.ativo %}
                        <span style="color: #28a745; font-weight: bold;"><i class="fas fa-check-circle"></i> Ativo</span>
                    {% else %}
                        <span style="color: #dc3545; font-weight: bold;"><i class="fas fa-times-circle"></i> Inativo</span>
                    {% endif %}
                </td>
                <td>
                    {% if usuario.ultimo_login %}
                        {{ usuario.ultimo_login.strftime('%d/%m/%Y às %H:%M') }}
                    {% else %}
                        <span style="color: #666; font-style: italic;">Nunca logou</span>
                    {% endif %}
                </td>
                <td style="white-space: nowrap;">
                    {% if usuario.id != current_user.id %}
                        {% if usuario.ativo %}
                            <form action="{{ url_for('desativar_usuario', usuario_id=usuario.id) }}" method="POST" style="display:inline;"

                                  onsubmit="return confirm('Tem certeza que deseja desativar o usuário {{ usuario.nome_completo }}?');">
                                  <input type="hidden" name="csrf_token" value="{{ csrf_token() }}">

                                <button type="submit" class="btn btn-small btn-warning">
                                    <i class="fas fa-user-slash"></i> Desativar
                                </button>
                            </form>
                        {% else %}
                            <form action="{{ url_for('ativar_usuario', usuario_id=usuario.id) }}" method="POST" style="display:inline;"
                                  onsubmit="return confirm('Tem certeza que deseja reativar o usuário {{ usuario.nome_completo }}?');">
                                <input type="hidden" name="csrf_token" value="{{ csrf_token() }}">
                                <button type="submit" class="btn btn-small btn-success">
                                    <i class="fas fa-user-check"></i> Ativar
                                </button>
                            </form>
                        {% endif %}
                    {% else %}
                        <span style="color: #666; font-style: italic; font-size: 0.9em;">
                            <i class="fas fa-user-shield"></i> Você
                        </span>
                    {% endif %}
                </td>
            </tr>
            {% endfor %}
        </tbody>
    </table>
</div>

<div class="card">
    <h3 style="color: #6a1b9a; margin-bottom: 15px;"><i class="fas fa-info-circle"></i> Informações sobre Permissões</h3>
    <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(300px, 1fr)); gap: 20px;">
        <div style="background: #e8f5e8; padding: 15px; border-radius: 8px; border-left: 4px solid #28a745;">
            <h4 style="color: #28a745; margin-bottom: 10px;"><i class="fas fa-crown"></i> Administrador</h4>
            <ul style="margin: 0; padding-left: 20px;">
                <li>Acesso completo ao sistema</li>
                <li>Dashboard com estatísticas</li>
                <li>Gerenciamento de clientes</li>
                <li>Relatórios de inadimplência</li>
                <li>Gerenciamento de usuários</li>
            </ul>
        </div>
        
        <div style="background: #e7f3ff; padding: 15px; border-radius: 8px; border-left: 4px solid #17a2b8;">
            <h4 style="color: #17a2b8; margin-bottom: 10px;"><i class="fas fa-user"></i> Colaborador</h4>
            <ul style="margin: 0; padding-left: 20px;">
                <li>Acesso limitado ao sistema</li>
                <li>Gerenciamento de clientes apenas</li>
                <li>Registrar pagamentos</li>
                <li>Visualizar histórico de pagamentos</li>
                <li>Não pode gerenciar usuários</li>
            </ul>
        </div>
    </div>
</div>

<style>
.badge {
    padding: 4px 8px;
    border-radius: 12px;
    font-size: 0.8em;
    font-weight: bold;
    color: white;
}

.badge.admin {
    background: #28a745;
}

.badge.colaborador {
    background: #17a2b8;
}
</style>
{% endblock %}